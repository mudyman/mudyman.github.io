<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«ä¸¤çš„åšå®¢ - è®°å½•æŠ€æœ¯ä¸ç”Ÿæ´»</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #2d3436;
            --accent: #6c5ce7;
            --accent-light: #a29bfe;
            --bg: #fafbfc;
            --card-bg: #ffffff;
            --text: #2d3436;
            --text-light: #636e72;
            --border: #e1e4e8;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
        }
        
        /* Header */
        header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-inner {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
            letter-spacing: -0.5px;
        }
        
        .logo span { color: var(--accent); }
        
        nav { display: flex; align-items: center; gap: 1.5rem; }
        
        nav a {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.2s;
        }
        
        nav a:hover { color: var(--accent); }
        
        .btn {
            padding: 0.6rem 1.4rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        .btn-primary {
            background: var(--accent);
            color: white;
        }
        
        .btn-primary:hover {
            background: #5849c4;
            transform: translateY(-1px);
        }
        
        .btn-outline {
            background: transparent;
            border: 1.5px solid var(--accent);
            color: var(--accent);
        }
        
        .btn-outline:hover {
            background: var(--accent);
            color: white;
        }
        
        .user-menu {
            display: none;
            align-items: center;
            gap: 1rem;
        }
        
        .user-menu.show { display: flex; }
        
        .user-email {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        /* Hero */
        .hero {
            background: linear-gradient(135deg, #2d3436 0%, #1a1a2e 100%);
            color: white;
            padding: 5rem 2rem;
            text-align: center;
        }
        
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .hero p {
            font-size: 1.2rem;
            opacity: 0.85;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Main */
        main {
            max-width: 800px;
            margin: 3rem auto;
            padding: 0 1.5rem;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }
        
        /* Post Card */
        .post-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .post-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        
        .post-card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 0.8rem;
            color: var(--primary);
            cursor: pointer;
        }
        
        .post-card h2:hover { color: var(--accent); }
        
        .post-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }
        
        .post-meta span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .post-excerpt {
            color: var(--text-light);
            line-height: 1.8;
        }
        
        .post-excerpt p {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .read-more {
            display: inline-block;
            margin-top: 1rem;
            color: var(--accent);
            font-weight: 500;
            cursor: pointer;
        }
        
        .read-more:hover { text-decoration: underline; }
        
        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }
        
        .action-btns {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-icon {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s;
            opacity: 0.6;
        }
        
        .btn-icon:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .btn-icon.edit:hover { background: #e3f2fd; }
        .btn-icon.delete:hover { background: #ffebee; }
        
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-light);
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1.5rem;
            opacity: 0.3;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal-overlay.show { display: flex; }
        
        .modal {
            background: var(--card-bg);
            border-radius: 20px;
            width: 100%;
            max-width: 480px;
            padding: 2.5rem;
            animation: modalIn 0.3s ease;
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .modal h2 {
            font-family: 'Playfair Display', serif;
            text-align: center;
            margin-bottom: 2rem;
            font-size: 1.8rem;
        }
        
        .form-group { margin-bottom: 1.2rem; }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.9rem 1rem;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .form-group textarea {
            min-height: 180px;
            resize: vertical;
        }
        
        .modal .btn { width: 100%; margin-top: 0.5rem; }
        
        .modal-footer {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-light);
        }
        
        .modal-footer a {
            color: var(--accent);
            cursor: pointer;
            font-weight: 500;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        
        .error-msg {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-bottom: 0.8rem;
            display: none;
        }
        
        .error-msg.show { display: block; }
        
        /* Footer */
        footer {
            background: var(--primary);
            color: white;
            text-align: center;
            padding: 3rem 2rem;
            margin-top: 4rem;
        }
        
        footer p { opacity: 0.7; }
        
        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            padding: 3rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .hero p { font-size: 1rem; }
            .header-inner { padding: 1rem; }
            .logo { font-size: 1.4rem; }
            .post-card { padding: 1.5rem; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <a href="/" class="logo">å…«ä¸¤<span>.</span></a>
            <nav>
                <a href="/">é¦–é¡µ</a>
                <a href="#" id="writeNav" style="display:none">å†™æ–‡ç« </a>
                <div class="user-menu" id="userMenu">
                    <span class="user-email" id="userEmail"></span>
                    <button class="btn btn-outline" onclick="logout()">é€€å‡º</button>
                </div>
                <div id="authButtons">
                    <button class="btn btn-outline" onclick="showModal('loginModal')">ç™»å½•</button>
                    <button class="btn btn-primary" onclick="showModal('registerModal')">æ³¨å†Œ</button>
                </div>
            </nav>
        </div>
    </header>
    
    <section class="hero">
        <h1>å…«ä¸¤çš„åšå®¢</h1>
        <p>è®°å½•æŠ€æœ¯æ¢ç´¢ä¸ç”Ÿæ´»æ„Ÿæ‚Ÿï¼Œåˆ†äº«è®©ä¸–ç•Œå˜å¾—æ›´å¥½çš„ç‚¹ç‚¹æ»´æ»´ã€‚</p>
    </section>
    
    <main>
        <h2 class="section-title">æœ€æ–°æ–‡ç« </h2>
        <div id="postsContainer">
            <div class="loading"><div class="spinner"></div></div>
        </div>
    </main>
    
    <!-- ç™»å½•å¼¹çª— -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <h2>æ¬¢è¿å›æ¥</h2>
            <div class="error-msg" id="loginError"></div>
            <form onsubmit="event.preventDefault(); login();">
                <div class="form-group">
                    <label>é‚®ç®±</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" id="loginPassword" placeholder="è¾“å…¥å¯†ç " required>
                </div>
                <button type="submit" class="btn btn-primary">ç™»å½•</button>
            </form>
            <div class="modal-footer">
                è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a onclick="switchModal('loginModal', 'registerModal')">ç«‹å³æ³¨å†Œ</a>
            </div>
        </div>
    </div>
    
    <!-- æ³¨å†Œå¼¹çª— -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal">
            <h2>åŠ å…¥æˆ‘ä»¬</h2>
            <div class="error-msg" id="registerError"></div>
            <form onsubmit="event.preventDefault(); register();">
                <div class="form-group">
                    <label>é‚®ç®±</label>
                    <input type="email" id="registerEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" id="registerPassword" placeholder="è‡³å°‘6ä½å¯†ç " required minlength="6">
                </div>
                <button type="submit" class="btn btn-primary">æ³¨å†Œ</button>
            </form>
            <div class="modal-footer">
                å·²æœ‰è´¦å·ï¼Ÿ<a onclick="switchModal('registerModal', 'loginModal')">ç«‹å³ç™»å½•</a>
            </div>
        </div>
    </div>
    
    <!-- å†™æ–‡ç« å¼¹çª— -->
    <div class="modal-overlay" id="writeModal">
        <div class="modal" style="max-width: 640px;">
            <h2>æ’°å†™æ–°æ–‡ç« </h2>
            <div class="error-msg" id="writeError"></div>
            <form onsubmit="event.preventDefault(); submitPost();">
                <div class="form-group">
                    <label>æ ‡é¢˜</label>
                    <input type="text" id="postTitle" placeholder="è¾“å…¥æ–‡ç« æ ‡é¢˜" required>
                </div>
                <div class="form-group">
                    <label>æ­£æ–‡</label>
                    <textarea id="postContent" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">å‘å¸ƒæ–‡ç« </button>
            </form>
            <div class="modal-footer">
                <a onclick="closeModal('writeModal')">å–æ¶ˆ</a>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘æ–‡ç« å¼¹çª— -->
    <div class="modal-overlay" id="editModal">
        <div class="modal" style="max-width: 640px;">
            <h2>ç¼–è¾‘æ–‡ç« </h2>
            <div class="error-msg" id="editError"></div>
            <form onsubmit="event.preventDefault(); updatePost();">
                <input type="hidden" id="editPostId">
                <div class="form-group">
                    <label>æ ‡é¢˜</label>
                    <input type="text" id="editPostTitle" placeholder="è¾“å…¥æ–‡ç« æ ‡é¢˜" required>
                </div>
                <div class="form-group">
                    <label>æ­£æ–‡</label>
                    <textarea id="editPostContent" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
            </form>
            <div class="modal-footer">
                <a onclick="closeModal('editModal')">å–æ¶ˆ</a>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal" style="max-width: 400px;">
            <h2>ç¡®è®¤åˆ é™¤</h2>
            <p style="text-align: center; color: var(--text-light); margin: 1.5rem 0;">ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚</p>
            <input type="hidden" id="deletePostId">
            <button onclick="confirmDelete()" class="btn" style="background: #e74c3c; color: white; width: 100%;">åˆ é™¤</button>
            <div class="modal-footer">
                <a onclick="closeModal('deleteModal')">å–æ¶ˆ</a>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Â© 2026 å…«ä¸¤çš„åšå®¢ Â· ç”¨ â™¥ï¸ æ„å»º</p>
    </footer>

    <script>
        // Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyAsjAfkl5N-8dHPciVjhZmfKy6Loo5n6QA",
            authDomain: "blog-fe0d5.firebaseapp.com",
            projectId: "blog-fe0d5",
            storageBucket: "blog-fe0d5.firebasestorage.app",
            messagingSenderId: "570968726858",
            appId: "1:570968726858:web:f8a2ee8a7335c80c9175b3",
            measurementId: "G-4QTFFD1FL5"
        };

        // åˆå§‹åŒ–
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let currentUser = null;

        // ç›‘å¬ç™»å½•çŠ¶æ€
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            updateUI();
            loadPosts();
        });

        function updateUI() {
            const userMenu = document.getElementById('userMenu');
            const authButtons = document.getElementById('authButtons');
            const writeNav = document.getElementById('writeNav');
            
            if (currentUser) {
                userMenu.classList.add('show');
                authButtons.style.display = 'none';
                writeNav.style.display = 'inline';
                document.getElementById('userEmail').textContent = currentUser.email.split('@')[0];
            } else {
                userMenu.classList.remove('show');
                authButtons.style.display = 'flex';
                writeNav.style.display = 'none';
            }
        }

        function loadPosts() {
            const container = document.getElementById('postsContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            db.collection('posts').orderBy('createdAt', 'desc').get()
                .then((snapshot) => {
                    if (snapshot.empty) {
                        container.innerHTML = `
                            <div class="empty-state">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V9a2 2 0 012-2h2a2 2 0 012 2v9a2 2 0 01-2 2h-2z"/>
                                </svg>
                                <p>è¿˜æ²¡æœ‰æ–‡ç« ï¼Œå¿«æ¥å†™ä¸‹ç¬¬ä¸€ç¯‡å§ï¼</p>
                            </div>
                        `;
                        return;
                    }
                    container.innerHTML = '';
                    snapshot.forEach((doc) => {
                        const post = doc.data();
                        const date = post.createdAt ? new Date(post.createdAt.seconds * 1000).toLocaleDateString('zh-CN') : 'æœªçŸ¥';
                        const html = `
                            <article class="post-card">
                                <h2 onclick="viewPost('${doc.id}')">${escapeHtml(post.title)}</h2>
                                <div class="post-meta">
                                    <span>ğŸ“… ${date}</span>
                                    <span>ğŸ‘¤ ${escapeHtml(post.author)}</span>
                                </div>
                                <div class="post-excerpt">
                                    <p>${escapeHtml(post.content)}</p>
                                </div>
                                <div class="post-actions">
                                    <span class="read-more" onclick="viewPost('${doc.id}')">é˜…è¯»å…¨æ–‡ â†’</span>
                                    ${currentUser && currentUser.email === post.author ? `
                                        <div class="action-btns">
                                            <button class="btn-icon edit" onclick="event.stopPropagation(); editPost('${doc.id}')" title="ç¼–è¾‘">âœï¸</button>
                                            <button class="btn-icon delete" onclick="event.stopPropagation(); deletePost('${doc.id}')" title="åˆ é™¤">ğŸ—‘ï¸</button>
                                        </div>
                                    ` : ''}
                                </div>
                            </article>
                        `;
                        container.innerHTML += html;
                    });
                })
                .catch((err) => {
                    container.innerHTML = `<div class="empty-state"><p>åŠ è½½å¤±è´¥: ${err.message}</p></div>`;
                });
        }

        function viewPost(id) {
            db.collection('posts').doc(id).get()
                .then((doc) => {
                    if (doc.exists) {
                        const post = doc.data();
                        alert(`${post.title}\n\nä½œè€…: ${post.author}\n\n${post.content}`);
                    }
                });
        }

        function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const errorEl = document.getElementById('registerError');
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => {
                    closeAllModals();
                    alert('æ³¨å†ŒæˆåŠŸï¼æ¬¢è¿åŠ å…¥æˆ‘ä»¬ ğŸ‰');
                })
                .catch((err) => {
                    errorEl.textContent = err.message;
                    errorEl.classList.add('show');
                });
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');
            
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    closeAllModals();
                })
                .catch((err) => {
                    errorEl.textContent = err.message;
                    errorEl.classList.add('show');
                });
        }

        function logout() { auth.signOut(); }

        function submitPost() {
            if (!currentUser) return alert('è¯·å…ˆç™»å½•');
            
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const errorEl = document.getElementById('writeError');
            
            if (!title || !content) {
                errorEl.textContent = 'è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹';
                errorEl.classList.add('show');
                return;
            }
            
            db.collection('posts').add({
                title,
                content,
                author: currentUser.email,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                closeAllModals();
                document.getElementById('postTitle').value = '';
                document.getElementById('postContent').value = '';
                loadPosts();
                alert('å‘å¸ƒæˆåŠŸï¼ğŸ‰');
            })
            .catch((err) => {
                errorEl.textContent = err.message;
                errorEl.classList.add('show');
            });
        }

        function showModal(id) {
            document.getElementById(id).classList.add('show');
        }

        function closeAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('show'));
            document.querySelectorAll('.error-msg').forEach(e => e.classList.remove('show'));
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        // ç¼–è¾‘æ–‡ç« 
        function editPost(postId) {
            db.collection('posts').doc(postId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const post = doc.data();
                        // æ£€æŸ¥æ˜¯å¦æ˜¯ä½œè€…
                        if (!currentUser || currentUser.email !== post.author) {
                            alert('åªæœ‰ä½œè€…å¯ä»¥ç¼–è¾‘æ–‡ç« ');
                            return;
                        }
                        document.getElementById('editPostId').value = postId;
                        document.getElementById('editPostTitle').value = post.title;
                        document.getElementById('editPostContent').value = post.content;
                        showModal('editModal');
                    }
                })
                .catch((err) => alert('åŠ è½½æ–‡ç« å¤±è´¥: ' + err.message));
        }

        // æ›´æ–°æ–‡ç« 
        function updatePost() {
            const postId = document.getElementById('editPostId').value;
            const title = document.getElementById('editPostTitle').value;
            const content = document.getElementById('editPostContent').value;
            const errorEl = document.getElementById('editError');

            if (!title || !content) {
                errorEl.textContent = 'è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹';
                errorEl.classList.add('show');
                return;
            }

            db.collection('posts').doc(postId).update({
                title: title,
                content: content,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                closeModal('editModal');
                document.getElementById('editPostId').value = '';
                document.getElementById('editPostTitle').value = '';
                document.getElementById('editPostContent').value = '';
                loadPosts();
                alert('æ–‡ç« å·²æ›´æ–°ï¼âœ…');
            })
            .catch((err) => {
                errorEl.textContent = err.message;
                errorEl.classList.add('show');
            });
        }

        // åˆ é™¤æ–‡ç« 
        function deletePost(postId) {
            db.collection('posts').doc(postId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const post = doc.data();
                        // æ£€æŸ¥æ˜¯å¦æ˜¯ä½œè€…
                        if (!currentUser || currentUser.email !== post.author) {
                            alert('åªæœ‰ä½œè€…å¯ä»¥åˆ é™¤æ–‡ç« ');
                            return;
                        }
                        document.getElementById('deletePostId').value = postId;
                        showModal('deleteModal');
                    }
                })
                .catch((err) => alert('åŠ è½½æ–‡ç« å¤±è´¥: ' + err.message));
        }

        // ç¡®è®¤åˆ é™¤
        function confirmDelete() {
            const postId = document.getElementById('deletePostId').value;

            db.collection('posts').doc(postId).delete()
                .then(() => {
                    closeModal('deleteModal');
                    document.getElementById('deletePostId').value = '';
                    loadPosts();
                    alert('æ–‡ç« å·²åˆ é™¤ï¼ğŸ—‘ï¸');
                })
                .catch((err) => {
                    alert('åˆ é™¤å¤±è´¥: ' + err.message);
                });
        }

        function switchModal(from, to) {
            document.getElementById(from).classList.remove('show');
            setTimeout(() => document.getElementById(to).classList.add('show'), 100);
        }

        document.getElementById('writeNav').onclick = () => showModal('writeModal');

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ç‚¹å‡»é®ç½©å…³é—­
        document.querySelectorAll('.modal-overlay').forEach(el => {
            el.onclick = (e) => { if (e.target === el) closeAllModals(); };
        });
    </script>
</body>
</html>
